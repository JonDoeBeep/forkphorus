<!DOCTYPE html>
<html>
  <head>
    <title>forkphorus embed fixer</title>
    <meta name="robots" content="noindex">
  </head>
  <body>

    <p>Does the embed script not work for you? Try this alternative version:</p>

    <input readonly type="text" id="embed">

    <p>This is a temporary hack to fix issues with certain sites.</p>

    <iframe src="http://localhost:8080/embed.html?id=357143074&auto-start=true&light-content=false&w=480&h=360" allowfullcreen="true" allowtransparency="true" style="border: none;" width="482" height="393"></iframe>

    <script>
      (function() {
        'use strict';

        var scriptSource = unescape(location.hash);
        var containerElement = document.createElement('div');
        containerElement.innerHTML = scriptSource;
        var parsedScript = containerElement.querySelector('script');

        if (!parsedScript) {
          alert('invalid script tag');
          return;
        }

        var src = parsedScript.src;
        var hasUI = true;
        var width = 480;
        var height = 360;

        src.split('?')[1].split('&').forEach(function(p) {
          var parts = p.split('=');
          switch (parts[0]) {
            case 'ui':
              hasUI = parts[1] !== 'false';
              break;
            case 'w':
              width = +parts[1];
              break;
            case 'h':
              height = +parts[1];
              break;
          }
        });

        var frame = '<iframe src="' + src.replace('embed.js', 'embed.html') + '" allowfullcreen="true" allowtransparency="true" style="border: none;"';

        if (hasUI) {
          width = width + 2;
          height = height + 33;
        }
        frame += ' width="' + width + '"';
        frame += ' height="' + height + '"';
        frame += '></iframe>';

        document.getElementById('embed').value = frame;

      }());
    </script>
  </body>
</html>